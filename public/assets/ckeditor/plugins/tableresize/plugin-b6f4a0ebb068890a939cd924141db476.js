/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function n(e){return CKEDITOR.env.ie?e.$.clientWidth:parseInt(e.getComputedStyle("width"),10)}function r(e,t){var n=e.getComputedStyle("border-"+t+"-width"),r={thin:"0px",medium:"1px",thick:"2px"};return n.indexOf("px")<0&&(n in r&&e.getComputedStyle("border-style")!="none"?n=r[n]:n=0),parseInt(n,10)}function i(e){var t=e.$.rows,n=0,r,i,s;for(var o=0,u=t.length;o<u;o++)s=t[o],r=s.cells.length,r>n&&(n=r,i=s);return i}function s(e){var t=[],n=-1,s=e.getComputedStyle("direction")=="rtl",o=i(e),u=new CKEDITOR.dom.element(e.$.tBodies[0]),a=u.getDocumentPosition();for(var f=0,l=o.cells.length;f<l;f++){var c=new CKEDITOR.dom.element(o.cells[f]),h=o.cells[f+1]&&new CKEDITOR.dom.element(o.cells[f+1]);n+=c.$.colSpan||1;var p,v,m,g=c.getDocumentPosition().x;s?v=g+r(c,"left"):p=g+c.$.offsetWidth-r(c,"right"),h?(g=h.getDocumentPosition().x,s?p=g+h.$.offsetWidth-r(h,"right"):v=g+r(h,"left")):(g=e.getDocumentPosition().x,s?p=g:v=g+e.$.offsetWidth),m=Math.max(v-p,3),t.push({table:e,index:n,x:p,y:a.y,width:m,height:u.$.offsetHeight,rtl:s})}return t}function o(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n];if(t>=i.x&&t<=i.x+i.width)return i}return null}function u(e){(e.data||e).preventDefault()}function a(i){function w(){s=null,p=0,f=0,o.removeListener("mouseup",N),a.removeListener("mousedown",T),a.removeListener("mousemove",C),o.getBody().setStyle("cursor","auto"),t?a.remove():a.hide()}function E(){var e=s.index,t=CKEDITOR.tools.buildTableMap(s.table),r=[],i=[],d=Number.MAX_VALUE,b=d,w=s.rtl;for(var E=0,S=t.length;E<S;E++){var x=t[E],T=x[e+(w?1:0)],N=x[e+(w?0:1)];T=T&&new CKEDITOR.dom.element(T),N=N&&new CKEDITOR.dom.element(N);if(!T||!N||!T.equals(N))T&&(d=Math.min(d,n(T))),N&&(b=Math.min(b,n(N))),r.push(T),i.push(N)}v=r,m=i,g=s.x-d,y=s.x+b,a.setOpacity(.5),l=parseInt(a.getStyle("left"),10),p=0,f=1,a.on("mousemove",C),o.on("dragstart",u)}function S(){f=0,a.setOpacity(0),p&&x();var e=s.table;setTimeout(function(){e.removeCustomData("_cke_table_pillars")},0),o.removeListener("dragstart",u)}function x(){var t=s.rtl,i=t?m.length:v.length;for(var o=0;o<i;o++){var u=v[o],a=m[o],f=s.table;CKEDITOR.tools.setTimeout(function(n,r,i,s,o,u){n&&n.setStyle("width",e(Math.max(r+u,0))),i&&i.setStyle("width",e(Math.max(s-u,0))),o&&f.setStyle("width",e(o+u*(t?-1:1)))},0,this,[u,u&&n(u),a,a&&n(a),(!u||!a)&&n(f)+r(f,"left")+r(f,"right"),p])}}function T(e){u(e),E(),o.on("mouseup",N,this)}function N(e){e.removeListener(),S()}function C(e){k(e.data.$.clientX)}var s,o,a,f,l,p,v,m,g,y;o=i.document,a=CKEDITOR.dom.element.createFromHtml('<div data-cke-temp=1 contenteditable=false unselectable=on style="position:absolute;cursor:col-resize;filter:alpha(opacity=0);opacity:0;padding:0;background-color:#004;background-image:none;border:0px none;z-index:10"></div>',o),t||o.getDocumentElement().append(a),this.attachTo=function(n){if(f)return;t&&(o.getBody().append(a),p=0),s=n,a.setStyles({width:e(n.width),height:e(n.height),left:e(n.x),top:e(n.y)}),t&&a.setOpacity(.25),a.on("mousedown",T,this),o.getBody().setStyle("cursor","col-resize"),a.show()};var k=this.move=function(t){if(!s)return 0;if(!f&&(t<s.x||t>s.x+s.width))return w(),0;var n=t-Math.round(a.$.offsetWidth/2);if(f){if(n==g||n==y)return 1;n=Math.max(n,g),n=Math.min(n,y),p=n-l}return a.setStyle("left",e(n)),1}}function f(e){var t=e.data.getTarget();if(e.name=="mouseout"){if(!t.is("table"))return;var n=new CKEDITOR.dom.element(e.data.$.relatedTarget||e.data.$.toElement);while(n&&n.$&&!n.equals(t)&&!n.is("body"))n=n.getParent();if(!n||n.equals(t))return}t.getAscendant("table",1).removeCustomData("_cke_table_pillars"),e.removeListener()}var e=CKEDITOR.tools.cssLength,t=CKEDITOR.env.ie&&(CKEDITOR.env.ie7Compat||CKEDITOR.env.quirks||CKEDITOR.env.version<7);CKEDITOR.plugins.add("tableresize",{requires:["tabletools"],init:function(e){e.on("contentDom",function(){var t;e.document.getBody().on("mousemove",function(n){n=n.data;if(t&&t.move(n.$.clientX)){u(n);return}var r=n.getTarget(),i,c;if(!r.is("table")&&!r.getAscendant("tbody",1))return;i=r.getAscendant("table",1),(c=i.getCustomData("_cke_table_pillars"))||(i.setCustomData("_cke_table_pillars",c=s(i)),i.on("mouseout",f),i.on("mousedown",f));var p=o(c,n.$.clientX);p&&(!t&&(t=new a(e)),t.attachTo(p))})})}})})();