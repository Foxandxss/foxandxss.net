/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
CKEDITOR.dialog.add("specialchar",function(e){var t,n=e.lang.specialChar,r=function(n){var r,i;n.data?r=n.data.getTarget():r=new CKEDITOR.dom.element(n);if(r.getName()=="a"&&(i=r.getChild(0).getHtml())){r.removeClass("cke_light_background"),t.hide();var s=e.document.createElement("span");s.setHtml(i),e.insertText(s.getText())}},i=CKEDITOR.tools.addFunction(r),s,o=function(e,n){var r;n=n||e.data.getTarget(),n.getName()=="span"&&(n=n.getParent());if(n.getName()=="a"&&(r=n.getChild(0).getHtml())){s&&u(null,s);var i=t.getContentElement("info","htmlPreview").getElement();t.getContentElement("info","charPreview").getElement().setHtml(r),i.setHtml(CKEDITOR.tools.htmlEncode(r)),n.getParent().addClass("cke_light_background"),s=n}},u=function(e,n){n=n||e.data.getTarget(),n.getName()=="span"&&(n=n.getParent()),n.getName()=="a"&&(t.getContentElement("info","charPreview").getElement().setHtml("&nbsp;"),t.getContentElement("info","htmlPreview").getElement().setHtml("&nbsp;"),n.getParent().removeClass("cke_light_background"),s=undefined)},a=CKEDITOR.tools.addFunction(function(t){t=new CKEDITOR.dom.event(t);var n=t.getTarget(),i,s,a=t.getKeystroke(),f=e.lang.dir=="rtl";switch(a){case 38:if(i=n.getParent().getParent().getPrevious())s=i.getChild([n.getParent().getIndex(),0]),s.focus(),u(null,n),o(null,s);t.preventDefault();break;case 40:if(i=n.getParent().getParent().getNext())s=i.getChild([n.getParent().getIndex(),0]),s&&s.type==1&&(s.focus(),u(null,n),o(null,s));t.preventDefault();break;case 32:r({data:t}),t.preventDefault();break;case f?37:39:case 9:if(i=n.getParent().getNext())s=i.getChild(0),s.type==1?(s.focus(),u(null,n),o(null,s),t.preventDefault(!0)):u(null,n);else if(i=n.getParent().getParent().getNext())s=i.getChild([0,0]),s&&s.type==1?(s.focus(),u(null,n),o(null,s),t.preventDefault(!0)):u(null,n);break;case f?39:37:case CKEDITOR.SHIFT+9:(i=n.getParent().getPrevious())?(s=i.getChild(0),s.focus(),u(null,n),o(null,s),t.preventDefault(!0)):(i=n.getParent().getParent().getPrevious())?(s=i.getLast().getChild(0),s.focus(),u(null,n),o(null,s),t.preventDefault(!0)):u(null,n);break;default:return}});return{title:n.title,minWidth:430,minHeight:280,buttons:[CKEDITOR.dialog.cancelButton],charColumns:17,onLoad:function(){var t=this.definition.charColumns,r=e.config.extraSpecialChars,s=e.config.specialChars,o=CKEDITOR.tools.getNextId()+"_specialchar_table_label",u=['<table role="listbox" aria-labelledby="'+o+'"'+' style="width: 320px; height: 100%; border-collapse: separate;"'+' align="center" cellspacing="2" cellpadding="2" border="0">'],f=0,l=s.length,h,p;while(f<l){u.push("<tr>");for(var d=0;d<t;d++,f++){if(h=s[f]){p="";if(h instanceof Array)p=h[1],h=h[0];else{var v=h.replace("&","").replace(";","").replace("#","");p=n[v]||h}var m="cke_specialchar_label_"+f+"_"+CKEDITOR.tools.getNextNumber();u.push('<td class="cke_dark_background" style="cursor: default" role="presentation"><a href="javascript: void(0);" role="option" aria-posinset="'+(f+1)+'"',' aria-setsize="'+l+'"',' aria-labelledby="'+m+'"',' style="cursor: inherit; display: block; height: 1.25em; margin-top: 0.25em; text-align: center;" title="',CKEDITOR.tools.htmlEncode(p),'" onkeydown="CKEDITOR.tools.callFunction( '+a+', event, this )"'+' onclick="CKEDITOR.tools.callFunction('+i+', this); return false;"'+' tabindex="-1">'+'<span style="margin: 0 auto;cursor: inherit">'+h+"</span>"+'<span class="cke_voice_label" id="'+m+'">'+p+"</span></a>")}else u.push('<td class="cke_dark_background">&nbsp;');u.push("</td>")}u.push("</tr>")}u.push("</tbody></table>",'<span id="'+o+'" class="cke_voice_label">'+n.options+"</span>"),this.getContentElement("info","charContainer").getElement().setHtml(u.join(""))},contents:[{id:"info",label:e.lang.common.generalTab,title:e.lang.common.generalTab,padding:0,align:"top",elements:[{type:"hbox",align:"top",widths:["320px","90px"],children:[{type:"html",id:"charContainer",html:"",onMouseover:o,onMouseout:u,focus:function(){var e=this.getElement().getElementsByTag("a").getItem(0);setTimeout(function(){e.focus(),o(null,e)},0)},onShow:function(){var e=this.getElement().getChild([0,0,0,0,0]);setTimeout(function(){e.focus(),o(null,e)},0)},onLoad:function(e){t=e.sender}},{type:"hbox",align:"top",widths:["100%"],children:[{type:"vbox",align:"top",children:[{type:"html",html:"<div></div>"},{type:"html",id:"charPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:28px;height:40px;width:70px;padding-top:9px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"},{type:"html",id:"htmlPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:14px;height:20px;width:70px;padding-top:2px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"}]}]}]}]}]}});