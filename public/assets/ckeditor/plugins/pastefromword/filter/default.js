/*
Copyright (c) 2003-2012, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/
(function(){function n(e){var t=e.children,n,r,i=e.children.length,s,o,u=/list-style-type:(.*?)(?:;|$)/,a=CKEDITOR.plugins.pastefromword.filters.stylesFilter;r=e.attributes;if(u.exec(r.style))return;for(var f=0;f<i;f++){n=t[f],n.attributes.value&&Number(n.attributes.value)==f+1&&delete n.attributes.value,s=u.exec(n.attributes.style);if(s){if(s[1]!=o&&!!o){o=null;break}o=s[1]}}if(o){for(f=0;f<i;f++)r=t[f].attributes,r.style&&(r.style=a([["list-style-type"]])(r.style)||"");e.addStyle("list-style-type",o)}}function p(e){e=e.toUpperCase();var t=c.length,n=0;for(var r=0;r<t;++r)for(var i=c[r],s=i[1].length;e.substr(0,s)==i[1];e=e.substr(s))n+=i[0];return n}function d(e){e=e.toUpperCase();var t=h.length,n=1;for(var r=1;e.length>0;r*=t)n+=h.indexOf(e.charAt(e.length-1))*r,e=e.substr(0,e.length-1);return n}var e=CKEDITOR.htmlParser.fragment.prototype,t=CKEDITOR.htmlParser.element.prototype;e.onlyChild=t.onlyChild=function(){var e=this.children,t=e.length,n=t==1&&e[0];return n||null},t.removeAnyChildWithName=function(e){var t=this.children,n=[],r;for(var i=0;i<t.length;i++){r=t[i];if(!r.name)continue;r.name==e&&(n.push(r),t.splice(i--,1)),n=n.concat(r.removeAnyChildWithName(e))}return n},t.getAncestor=function(e){var t=this.parent;while(t&&(!t.name||!t.name.match(e)))t=t.parent;return t},e.firstChild=t.firstChild=function(e){var t;for(var n=0;n<this.children.length;n++){t=this.children[n];if(e(t))return t;if(t.name){t=t.firstChild(e);if(t)return t}}return null},t.addStyle=function(e,t,n){var r=this,i,s="";if(typeof t=="string")s+=e+":"+t+";";else{if(typeof e=="object")for(var o in e)e.hasOwnProperty(o)&&(s+=o+":"+e[o]+";");else s+=e;n=t}r.attributes||(r.attributes={}),i=r.attributes.style||"",i=(n?[s,i]:[i,s]).join(";"),r.attributes.style=i.replace(/^;|;(?=;)/,"")},CKEDITOR.dtd.parentOf=function(e){var t={};for(var n in this)n.indexOf("$")==-1&&this[n][e]&&(t[n]=1);return t};var r=/^([.\d]*)+(em|ex|px|gd|rem|vw|vh|vm|ch|mm|cm|in|pt|pc|deg|rad|ms|s|hz|khz){1}?/i,i=/^(?:\b0[^\s]*\s*){1,4}$/,s="^m{0,4}(cm|cd|d?c{0,3})(xc|xl|l?x{0,3})(ix|iv|v?i{0,3})$",o=new RegExp(s),u=new RegExp(s.toUpperCase()),a={decimal:/\d+/,"lower-roman":o,"upper-roman":u,"lower-alpha":/^[a-z]+$/,"upper-alpha":/^[A-Z]+$/},f={disc:/[l\u00B7\u2002]/,circle:/[\u006F\u00D8]/,square:/[\u006E\u25C6]/},l={ol:a,ul:f},c=[[1e3,"M"],[900,"CM"],[500,"D"],[400,"CD"],[100,"C"],[90,"XC"],[50,"L"],[40,"XL"],[10,"X"],[9,"IX"],[5,"V"],[4,"IV"],[1,"I"]],h="ABCDEFGHIJKLMNOPQRSTUVWXYZ",v=0,m=null,g,y=CKEDITOR.plugins.pastefromword={utils:{createListBulletMarker:function(e,t){var n=new CKEDITOR.htmlParser.element("cke:listbullet");return n.attributes={"cke:listsymbol":e[0]},n.add(new CKEDITOR.htmlParser.text(t)),n},isListBulletIndicator:function(e){var t=e.attributes&&e.attributes.style;if(/mso-list\s*:\s*Ignore/i.test(t))return!0},isContainingOnlySpaces:function(e){var t;return(t=e.onlyChild())&&/^(:?\s|&nbsp;)+$/.test(t.value)},resolveList:function(e){var t=e.attributes,n;return(n=e.removeAnyChildWithName("cke:listbullet"))&&n.length&&(n=n[0])?(e.name="cke:li",t.style&&(t.style=y.filters.stylesFilter([["text-indent"],["line-height"],[/^margin(:?-left)?$/,null,function(e){var n=e.split(" ");e=CKEDITOR.tools.convertToPx(n[3]||n[1]||n[0]),!v&&m!==null&&e>m&&(v=e-m),m=e,t["cke:indent"]=v&&Math.ceil(e/v)+1||1}],[/^mso-list$/,null,function(e){e=e.split(" ");var n=Number(e[0].match(/\d+/)),r=Number(e[1].match(/\d+/));r==1&&(n!==g&&(t["cke:reset"]=1),g=n),t["cke:indent"]=r}]])(t.style,e)||""),t["cke:indent"]||(m=0,t["cke:indent"]=1),CKEDITOR.tools.extend(t,n.attributes),!0):(g=m=v=null,!1)},getStyleComponents:function(){var e=CKEDITOR.dom.element.createFromHtml('<div style="position:absolute;left:-9999px;top:-9999px;"></div>',CKEDITOR.document);return CKEDITOR.document.getBody().append(e),function(t,n,r){e.setStyle(t,n);var i={},s=r.length;for(var o=0;o<s;o++)i[r[o]]=e.getStyle(r[o]);return i}}(),listDtdParents:CKEDITOR.dtd.parentOf("ol")},filters:{flattenList:function(e,t){t=typeof t=="number"?t:1;var n=e.attributes,i;switch(n.type){case"a":i="lower-alpha";break;case"1":i="decimal"}var s=e.children,o;for(var u=0;u<s.length;u++){o=s[u];if(o.name in CKEDITOR.dtd.$listItem){var a=o.attributes,f=o.children,l=f.length,c=f[l-1];c.name in CKEDITOR.dtd.$list&&(e.add(c,u+1),--f.length||s.splice(u--,1)),o.name="cke:li",n.start&&!u&&(a.value=n.start),y.filters.stylesFilter([["tab-stops",null,function(e){var t=e.split(" ")[1].match(r);t&&(m=CKEDITOR.tools.convertToPx(t[0]))}],t==1?["mso-list",null,function(e){e=e.split(" ");var t=Number(e[0].match(/\d+/));t!==g&&(a["cke:reset"]=1),g=t}]:null])(a.style),a["cke:indent"]=t,a["cke:listtype"]=e.name,a["cke:list-style-type"]=i}else if(o.name in CKEDITOR.dtd.$list){arguments.callee.apply(this,[o,t+1]),s=s.slice(0,u).concat(o.children).concat(s.slice(u+1)),e.children=[];for(var h=0,p=s.length;h<p;h++)e.add(s[h])}}delete e.name,n["cke:list"]=1},assembleList:function(e){var t=e.children,r,i,s,o,u,a,f,c=[],h,y,b,w,E,S;for(var x=0;x<t.length;x++){r=t[x];if("cke:li"==r.name){r.name="li",i=r,s=i.attributes,b=s["cke:listsymbol"],b=b&&b.match(/^(?:[(]?)([^\s]+?)([.)]?)$/),w=E=S=null;if(s["cke:ignored"]){t.splice(x--,1);continue}s["cke:reset"]&&(f=u=a=null),o=Number(s["cke:indent"]),o!=u&&(y=h=null);if(!b)w=s["cke:listtype"]||"ol",E=s["cke:list-style-type"];else{if(y&&l[y][h].test(b[1]))w=y,E=h;else for(var T in l)for(var N in l[T])if(l[T][N].test(b[1])){if(T!="ol"||!/alpha|roman/.test(N)){w=T,E=N;break}var C=/roman/.test(N)?p(b[1]):d(b[1]);if(!S||C<S)S=C,w=T,E=N}!w&&(w=b[2]?"ol":"ul")}y=w,h=E||(w=="ol"?"decimal":"disc"),E&&E!=(w=="ol"?"decimal":"disc")&&i.addStyle("list-style-type",E);if(w=="ol"&&b){switch(E){case"decimal":S=Number(b[1]);break;case"lower-roman":case"upper-roman":S=p(b[1]);break;case"lower-alpha":case"upper-alpha":S=d(b[1])}i.attributes.value=S}if(!f)c.push(f=new CKEDITOR.htmlParser.element(w)),f.add(i),t[x]=f;else{if(o>u)c.push(f=new CKEDITOR.htmlParser.element(w)),f.add(i),a.add(f);else if(o<u){var L=u-o,A;while(L--&&(A=f.parent))f=A.parent;f.add(i)}else f.add(i);t.splice(x--,1)}a=i,u=o}else f&&(f=u=a=null)}for(x=0;x<c.length;x++)n(c[x]);f=u=a=g=m=v=null},falsyFilter:function(e){return!1},stylesFilter:function(e,t){return function(n,r){var i=[];(n||"").replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(n,s,o){s=s.toLowerCase(),s=="font-family"&&(o=o.replace(/["']/g,""));var u,a,f,l;for(var c=0;c<e.length;c++)if(e[c]){u=e[c][0],a=e[c][1],f=e[c][2],l=e[c][3];if(s.match(u)&&(!a||o.match(a))){s=l||s,t&&(f=f||o),typeof f=="function"&&(f=f(o,r,s)),f&&f.push&&(s=f[0],f=f[1]),typeof f=="string"&&i.push([s,f]);return}}!t&&i.push([s,o])});for(var s=0;s<i.length;s++)i[s]=i[s].join(":");return i.length?i.join(";")+";":!1}},elementMigrateFilter:function(e,t){return function(n){var r=t?(new CKEDITOR.style(e,t))._.definition:e;n.name=r.element,CKEDITOR.tools.extend(n.attributes,CKEDITOR.tools.clone(r.attributes)),n.addStyle(CKEDITOR.style.getStyleText(r))}},styleMigrateFilter:function(e,t){var n=this.elementMigrateFilter;return function(r,i){var s=new CKEDITOR.htmlParser.element(null),o={};o[t]=r,n(e,o)(s),s.children=i.children,i.children=[s]}},bogusAttrFilter:function(e,t){if(t.name.indexOf("cke:")==-1)return!1},applyStyleFilter:null},getRules:function(e){var t=CKEDITOR.dtd,n=CKEDITOR.tools.extend({},t.$block,t.$listItem,t.$tableContent),r=e.config,s=this.filters,o=s.falsyFilter,u=s.stylesFilter,a=s.elementMigrateFilter,f=CKEDITOR.tools.bind(this.filters.styleMigrateFilter,this.filters),l=this.utils.createListBulletMarker,c=s.flattenList,h=s.assembleList,p=this.utils.isListBulletIndicator,d=this.utils.isContainingOnlySpaces,v=this.utils.resolveList,m=function(e){return e=CKEDITOR.tools.convertToPx(e),isNaN(e)?e:e+"px"},g=this.utils.getStyleComponents,y=this.utils.listDtdParents,b=r.pasteFromWordRemoveFontStyles!==!1,w=r.pasteFromWordRemoveStyles!==!1;return{elementNames:[[/meta|link|script/,""]],root:function(e){e.filterChildren(),h(e)},elements:{"^":function(e){var t;CKEDITOR.env.gecko&&(t=s.applyStyleFilter)&&t(e)},$:function(e){var i=e.name||"",s=e.attributes;i in n&&s.style&&(s.style=u([[/^(:?width|height)$/,null,m]])(s.style)||"");if(i.match(/h\d/)){e.filterChildren();if(v(e))return;a(r["format_"+i])(e)}else if(i in t.$inline)e.filterChildren(),d(e)&&delete e.name;else if(i.indexOf(":")!=-1&&i.indexOf("cke")==-1){e.filterChildren();if(i=="v:imagedata"){var o=e.attributes["o:href"];o&&(e.attributes.src=o),e.name="img";return}delete e.name}i in y&&(e.filterChildren(),h(e))},style:function(e){if(CKEDITOR.env.gecko){var t=e.onlyChild().value.match(/\/\* Style Definitions \*\/([\s\S]*?)\/\*/),n=t&&t[1],r={};n&&(n.replace(/[\n\r]/g,"").replace(/(.+?)\{(.+?)\}/g,function(e,t,n){t=t.split(",");var i=t.length,s;for(var o=0;o<i;o++)CKEDITOR.tools.trim(t[o]).replace(/^(\w+)(\.[\w-]+)?$/g,function(e,t,i){t=t||"*",i=i.substring(1,i.length);if(i.match(/MsoNormal/))return;r[t]||(r[t]={}),i?r[t][i]=n:r[t]=n})}),s.applyStyleFilter=function(e){var t=r["*"]?"*":e.name,n=e.attributes&&e.attributes["class"],i;t in r&&(i=r[t],typeof i=="object"&&(i=i[n]),i&&e.addStyle(i,!0))})}return!1},p:function(e){if(/MsoListParagraph/.exec(e.attributes["class"])){var t=e.firstChild(function(e){return e.type==CKEDITOR.NODE_TEXT&&!d(e.parent)}),n=t&&t.parent,i=n&&n.attributes;i&&!i.style&&(i.style="mso-list: Ignore;")}e.filterChildren();if(v(e))return;r.enterMode==CKEDITOR.ENTER_BR?(delete e.name,e.add(new CKEDITOR.htmlParser.element("br"))):a(r["format_"+(r.enterMode==CKEDITOR.ENTER_P?"p":"div")])(e)},div:function(e){var t=e.onlyChild();if(t&&t.name=="table"){var n=e.attributes;t.attributes=CKEDITOR.tools.extend(t.attributes,n),n.style&&t.addStyle(n.style);var r=new CKEDITOR.htmlParser.element("div");r.addStyle("clear","both"),e.add(r),delete e.name}},td:function(e){e.getAncestor("thead")&&(e.name="th")},ol:c,ul:c,dl:c,font:function(e){if(p(e.parent)){delete e.name;return}e.filterChildren();var t=e.attributes,n=t.style,r=e.parent;"font"==r.name?(CKEDITOR.tools.extend(r.attributes,e.attributes),n&&r.addStyle(n),delete e.name):(n=n||"",t.color&&(t.color!="#000000"&&(n+="color:"+t.color+";"),delete t.color),t.face&&(n+="font-family:"+t.face+";",delete t.face),t.size&&(n+="font-size:"+(t.size>3?"large":t.size<3?"small":"medium")+";",delete t.size),e.name="span",e.addStyle(n))},span:function(e){if(p(e.parent))return!1;e.filterChildren();if(d(e))return delete e.name,null;if(p(e)){var t=e.firstChild(function(e){return e.value||e.name=="img"}),n=t&&(t.value||"l."),i=n&&n.match(/^(?:[(]?)([^\s]+?)([.)]?)$/);if(i){var s=l(i,n),o=e.getAncestor("span");return o&&/ mso-hide:\s*all|display:\s*none /.test(o.attributes.style)&&(s.attributes["cke:ignored"]=1),s}}var a=e.children,c=e.attributes,h=c&&c.style,v=a&&a[0];return h&&(c.style=u([["line-height"],[/^font-family$/,null,b?null:f(r.font_style,"family")],[/^font-size$/,null,b?null:f(r.fontSize_style,"size")],[/^color$/,null,b?null:f(r.colorButton_foreStyle,"color")],[/^background-color$/,null,b?null:f(r.colorButton_backStyle,"color")]])(h,e)||""),null},b:a(r.coreStyles_bold),i:a(r.coreStyles_italic),u:a(r.coreStyles_underline),s:a(r.coreStyles_strike),sup:a(r.coreStyles_superscript),sub:a(r.coreStyles_subscript),a:function(e){var t=e.attributes;t&&!t.href&&t.name?delete e.name:CKEDITOR.env.webkit&&t.href&&t.href.match(/file:\/\/\/[\S]+#/i)&&(t.href=t.href.replace(/file:\/\/\/[^#]+/i,""))},"cke:listbullet":function(e){e.getAncestor(/h\d/)&&!r.pasteFromWordNumberedHeadingToList&&delete e.name}},attributeNames:[[/^onmouse(:?out|over)/,""],[/^onload$/,""],[/(?:v|o):\w+/,""],[/^lang/,""]],attributes:{style:u(w?[[/^list-style-type$/,null],[/^margin$|^margin-(?!bottom|top)/,null,function(e,t,n){if(t.name in{p:1,div:1}){var s=r.contentsLangDirection=="ltr"?"margin-left":"margin-right";if(n=="margin")e=g(n,e,[s])[s];else if(n!=s)return null;if(e&&!i.test(e))return[s,e]}return null}],[/^clear$/],[/^border.*|margin.*|vertical-align|float$/,null,function(e,t){if(t.name=="img")return e}],[/^width|height$/,null,function(e,t){if(t.name in{table:1,td:1,th:1,img:1})return e}]]:[[/^mso-/],[/-color$/,null,function(e){if(e=="transparent")return!1;if(CKEDITOR.env.gecko)return e.replace(/-moz-use-text-color/g,"transparent")}],[/^margin$/,i],["text-indent","0cm"],["page-break-before"],["tab-stops"],["display","none"],b?[/font-?/]:null],w),width:function(e,n){if(n.name in t.$tableContent)return!1},border:function(e,n){if(n.name in t.$tableContent)return!1},"class":o,bgcolor:o,valign:w?o:function(e,t){return t.addStyle("vertical-align",e),!1}},comment:CKEDITOR.env.ie?o:function(e,t){var n=e.match(/<img.*?>/),r=e.match(/^\[if !supportLists\]([\s\S]*?)\[endif\]$/);if(r){var i=r[1]||n&&"l.",s=i&&i.match(/>(?:[(]?)([^\s]+?)([.)]?)</);return l(s,i)}if(CKEDITOR.env.gecko&&n){var o=CKEDITOR.htmlParser.fragment.fromHtml(n[0]).children[0],u=t.previous,a=u&&u.value.match(/<v:imagedata[^>]*o:href=['"](.*?)['"]/),f=a&&a[1];return f&&(o.attributes.src=f),o}return!1}}}},b=function(){this.dataFilter=new CKEDITOR.htmlParser.filter};b.prototype={toHtml:function(e){var t=CKEDITOR.htmlParser.fragment.fromHtml(e,!1),n=new CKEDITOR.htmlParser.basicWriter;return t.writeHtml(n,this.dataFilter),n.getHtml(!0)}},CKEDITOR.cleanWord=function(e,t){CKEDITOR.env.gecko&&(e=e.replace(/(<!--\[if[^<]*?\])-->([\S\s]*?)<!--(\[endif\]-->)/gi,"$1$2$3"));var n=new b,r=n.dataFilter;r.addRules(CKEDITOR.plugins.pastefromword.getRules(t)),t.fire("beforeCleanWord",{filter:r});try{e=n.toHtml(e,!1)}catch(i){alert(t.lang.pastefromword.error)}return e=e.replace(/cke:.*?".*?"/g,""),e=e.replace(/style=""/g,""),e=e.replace(/<span>/g,""),e}})();